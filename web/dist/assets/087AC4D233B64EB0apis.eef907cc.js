/*! 
 Build based on gin-vue-admin 
 Time : 1718987800000 */
import{s as a,a as t,W as e,o as s,c as o,b as r,d as i,w as l,g as n,k as p,l as d,E as c}from"./087AC4D233B64EB0index.72fd2312.js";/* empty css                                  */import{E as u}from"./087AC4D233B64EB0tree.14d56280.js";import"./087AC4D233B64EB0checkbox.ca4c4f80.js";/* empty css                               *//* empty css                              */import{e as h}from"./087AC4D233B64EB0api.9e955f26.js";import{E as m}from"./087AC4D233B64EB0index.ffab591b.js";import"./087AC4D233B64EB0index.dd70ec89.js";import"./087AC4D233B64EB0isEqual.add17071.js";import"./087AC4D233B64EB0_Uint8Array.d3e78e14.js";import"./087AC4D233B64EB0hasIn.391c448e.js";const B={class:"sticky top-0.5 z-10 bg-white"},f={class:"tree-content"},y=Object.assign({name:"Apis"},{__name:"apis",props:{row:{default:function(){return{}},type:Object}},setup(y,{expose:v}){const E=y,C=t({children:"children",label:"description"}),b=t(""),j=t([]),A=t([]),k=t("");(async()=>{const t=(await h()).data.apis;j.value=g(t);const e=await(s={authorityId:E.row.authorityId},a({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;k.value=E.row.authorityId,A.value=[],e.data.paths&&e.data.paths.forEach((a=>{A.value.push("p:"+a.path+"m:"+a.method)}))})();const D=t(!1),w=()=>{D.value=!0},g=a=>{const t={};a&&a.forEach((a=>{a.onlyId="p:"+a.path+"m:"+a.method,Object.prototype.hasOwnProperty.call(t,a.apiGroup)?t[a.apiGroup].push(a):Object.assign(t,{[a.apiGroup]:[a]})}));const e=[];for(const s in t){const a={ID:s,description:s+"组",children:t[s]};e.push(a)}return e},x=t(null),I=async()=>{const t=x.value.getCheckedNodes(!0);var e=[];t&&t.forEach((a=>{var t={path:a.path,method:a.method};e.push(t)}));var s;0===(await(s={authorityId:k.value,casbinInfos:e},a({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&p({type:"success",message:"api设置成功"})};v({needConfirm:D,enterAndNext:()=>{I()}});const O=(a,t)=>!a||-1!==t.description.indexOf(a);return e(b,(a=>{x.value.filter(a)})),(a,t)=>{const e=d,p=c,h=u,y=m;return s(),o("div",null,[r("div",B,[i(e,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),class:"w-3/5",placeholder:"筛选"},null,8,["modelValue"]),i(p,{class:"float-right",type:"primary",onClick:I},{default:l((()=>[n("确 定")])),_:1})]),r("div",f,[i(y,null,{default:l((()=>[i(h,{ref_key:"apiTree",ref:x,data:j.value,"default-checked-keys":A.value,props:C.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":O,onCheck:w},null,8,["data","default-checked-keys","props"])])),_:1})])])}}});export{y as default};
