/*! 
 Build based on gin-vue-admin 
 Time : 1718987800000 */
import{a as e,o as a,h as l,w as t,d as i,b as o,g as s,c as r,N as u,O as n,G as d,t as m,ap as p,k as c,l as v,E as g,J as h,W as y,e as B,db as f,dc as C,dd as b,de as w,df as D,Q as E,dg as j}from"./087AC4D233B64EB0index.72fd2312.js";/* empty css                               *//* empty css                                *//* empty css                                  *//* empty css                              *//* empty css                                   *//* empty css                            *//* empty css                               *//* empty css                                  *//* empty css                               */import{E as I,a as A}from"./087AC4D233B64EB0table-column.a0d188fb.js";import"./087AC4D233B64EB0checkbox.ca4c4f80.js";/* empty css                                */import{E as _}from"./087AC4D233B64EB0switch.17102a26.js";import{E as k}from"./087AC4D233B64EB0radio.95911a51.js";/* empty css                               */import{g as V}from"./087AC4D233B64EB0authority.4a92693a.js";import{C as x}from"./087AC4D233B64EB0index.60640113.js";/* empty css                                     */import{_ as N,U as z,a as U,g as S,e as O}from"./087AC4D233B64EB0common.3f12f33f.js";import{_ as T}from"./087AC4D233B64EB0warningBar.90f1d9d1.js";import{a as J,E as q}from"./087AC4D233B64EB0index.7b396154.js";import{E as F}from"./087AC4D233B64EB0index.708655ee.js";import{E as K}from"./087AC4D233B64EB0index.111d928a.js";import{E as P}from"./087AC4D233B64EB0index.1c56beac.js";import"./087AC4D233B64EB0index.ffab591b.js";import"./087AC4D233B64EB0index.a0571a5c.js";import"./087AC4D233B64EB0isUndefined.d281c39a.js";import"./087AC4D233B64EB0_baseIteratee.e71013e5.js";import"./087AC4D233B64EB0_Uint8Array.d3e78e14.js";import"./087AC4D233B64EB0isEqual.add17071.js";import"./087AC4D233B64EB0hasIn.391c448e.js";import"./087AC4D233B64EB0debounce.1e721c0b.js";import"./087AC4D233B64EB0_initCloneObject.253b0cea.js";import"./087AC4D233B64EB0strings.ee229cfb.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";import"./087AC4D233B64EB0cloneDeep.182936bd.js";import"./087AC4D233B64EB0_baseClone.503fbc91.js";import"./087AC4D233B64EB0index.ea000fb0.js";/* empty css                               *//* empty css                                 *//* empty css                                                                              */import"./087AC4D233B64EB0index.e6ff289d.js";import"./087AC4D233B64EB0index.063cc7d2.js";import"./087AC4D233B64EB0castArray.673ea73c.js";import"./087AC4D233B64EB0index.3d51996d.js";import"./087AC4D233B64EB0use-dialog.3fba8604.js";const $={class:"gva-btn-list"},G={class:"media"},R={class:"header-img-box-list"},W={class:"header-img-box-list"},X=o("picture",null,null,-1),Z=["onClick"],H={__name:"index",props:{target:{type:Object,default:null},targetKey:{type:String,default:""}},emits:["enterImg"],setup(y,{expose:B,emit:f}){const C=e(""),b=e(""),w=e({}),D=e(1),E=e(0),j=e(20),I=e=>{j.value=e,x()},A=e=>{D.value=e,x()},_=f,k=e(!1),V=e([]),x=async()=>{const e=await S({page:D.value,pageSize:j.value,...w.value});0===e.code&&(V.value=e.data.list,E.value=e.data.total,D.value=e.data.page,j.value=e.data.pageSize,k.value=!0)};return B({open:x}),(e,B)=>{const f=v,S=J,H=g,M=q,Q=h,Y=F,L=K,ee=P;return a(),l(ee,{modelValue:k.value,"onUpdate:modelValue":B[1]||(B[1]=e=>k.value=e),title:"媒体库",size:"650px"},{default:t((()=>[i(T,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),o("div",$,[i(N,{"image-common":b.value,class:"upload-btn-media-library",onOnSuccess:x},null,8,["image-common"]),i(z,{"image-url":C.value,"file-size":512,"max-w-h":1080,class:"upload-btn-media-library",onOnSuccess:x},null,8,["image-url"]),i(M,{ref:"searchForm",inline:!0,model:w.value},{default:t((()=>[i(S,{label:""},{default:t((()=>[i(f,{modelValue:w.value.keyword,"onUpdate:modelValue":B[0]||(B[0]=e=>w.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),i(S,null,{default:t((()=>[i(H,{type:"primary",icon:"search",onClick:x},{default:t((()=>[s("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),o("div",G,[(a(!0),r(u,null,n(V.value,((e,s)=>(a(),r("div",{key:s,class:"media-box"},[o("div",R,[(a(),l(Y,{key:s,src:d(U)(e.url),onClick:a=>{return l=e.url,t=y.target,i=y.targetKey,t&&i&&(t[i]=l),_("enterImg",l),void(k.value=!1);var l,t,i}},{error:t((()=>[o("div",W,[i(Q,null,{default:t((()=>[X])),_:1})])])),_:2},1032,["src","onClick"]))]),o("div",{class:"img-title",onClick:a=>(async e=>{p.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await O(e)).code&&(c({type:"success",message:"编辑成功!"}),x())})).catch((()=>{c({type:"info",message:"取消修改"})}))})(e)},m(e.name),9,Z)])))),128))]),i(L,{"current-page":D.value,"page-size":j.value,total:E.value,style:{"justify-content":"center"},layout:"total, prev, pager, next, jumper",onCurrentChange:A,onSizeChange:I},null,8,["current-page","page-size","total"])])),_:1},8,["modelValue"])}}},M={class:"gva-table-box"},Q={class:"gva-btn-list"},Y={class:"gva-pagination"},L={class:"flex justify-between items-center"},ee=o("span",{class:"text-lg"},"用户",-1),ae=["src"],le={key:1,class:"header-img-box"},te=Object.assign({name:"User"},{__name:"user",setup(u){const n=e("/api/"),d=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};d(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},m=e(1),h=e(0),N=e(10),z=e([]),U=e=>{N.value=e,O()},S=e=>{m.value=e,O()},O=async()=>{const e=await f({page:m.value,pageSize:N.value});0===e.code&&(z.value=e.data.list,h.value=e.data.total,m.value=e.data.page,N.value=e.data.pageSize)};y((()=>z.value),(()=>{F()}));(async()=>{O();const e=await V({page:1,pageSize:999});W(e.data.list)})();const F=()=>{z.value&&z.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))},$=e(null),G=()=>{$.value.open()},R=e([]),W=e=>{R.value=[],d(e,R.value)},X=e({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),Z=e({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),te=e(null),ie=async()=>{X.value.authorityId=X.value.authorityIds[0],te.value.validate((async e=>{if(e){const e={...X.value};if("add"===re.value){0===(await w(e)).code&&(c({type:"success",message:"创建成功"}),await O(),se())}if("edit"===re.value){0===(await D(e)).code&&(c({type:"success",message:"编辑成功"}),await O(),se())}}}))},oe=e(!1),se=()=>{te.value.resetFields(),X.value.headerImg="",X.value.authorityIds=[],oe.value=!1},re=e("add"),ue=()=>{re.value="add",oe.value=!0},ne={},de=async(e,a,l)=>{if(a)return void(l||(ne[e.ID]=[...e.authorityIds]));await E();0===(await j({ID:e.ID,authorityIds:e.authorityIds})).code?c({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...ne[e.ID]],delete ne[e.ID])};return(e,u)=>{const d=g,y=I,f=k,w=_,j=A,V=K,F=v,W=J,ne=q,me=P;return a(),r("div",null,[i(T,{title:"注：右上角头像下拉可切换角色"}),o("div",M,[o("div",Q,[i(d,{type:"primary",icon:"plus",onClick:ue},{default:t((()=>[s("新增用户")])),_:1})]),i(j,{data:z.value,"row-key":"ID"},{default:t((()=>[i(y,{align:"left",label:"头像","min-width":"75"},{default:t((e=>[i(x,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),i(y,{align:"left",label:"ID","min-width":"50",prop:"ID"}),i(y,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),i(y,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),i(y,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),i(y,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),i(y,{align:"left",label:"用户角色","min-width":"200"},{default:t((e=>[i(f,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:R.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{de(e.row,a,0)},onRemoveTag:a=>{de(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),i(y,{align:"left",label:"启用","min-width":"150"},{default:t((e=>[i(w,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{X.value=JSON.parse(JSON.stringify(e)),await E();const a={...X.value};0===(await D(a)).code&&(c({type:"success",message:"".concat(2===a.enable?"禁用":"启用","成功")}),await O(),X.value.headerImg="",X.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),i(y,{label:"操作","min-width":"250",fixed:"right"},{default:t((e=>[i(d,{type:"primary",link:"",icon:"delete",onClick:a=>(async e=>{p.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await b({id:e.ID})).code&&(c.success("删除成功"),await O())}))})(e.row)},{default:t((()=>[s("删除")])),_:2},1032,["onClick"]),i(d,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,re.value="edit",X.value=JSON.parse(JSON.stringify(l)),void(oe.value=!0);var l}},{default:t((()=>[s("编辑")])),_:2},1032,["onClick"]),i(d,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,void p.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await C({ID:l.ID});0===e.code?c({type:"success",message:e.msg}):c({type:"error",message:e.msg})}));var l}},{default:t((()=>[s("重置密码")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",Y,[i(V,{"current-page":m.value,"page-size":N.value,"page-sizes":[10,30,50,100],total:h.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:S,onSizeChange:U},null,8,["current-page","page-size","total"])])]),i(me,{modelValue:oe.value,"onUpdate:modelValue":u[7]||(u[7]=e=>oe.value=e),size:"60%","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{title:t((()=>[o("div",L,[ee,o("div",null,[i(d,{onClick:se},{default:t((()=>[s("取 消")])),_:1}),i(d,{type:"primary",onClick:ie},{default:t((()=>[s("确 定")])),_:1})])])])),default:t((()=>[i(ne,{ref_key:"userForm",ref:te,rules:Z.value,model:X.value,"label-width":"80px"},{default:t((()=>["add"===re.value?(a(),l(W,{key:0,label:"用户名",prop:"userName"},{default:t((()=>[i(F,{modelValue:X.value.userName,"onUpdate:modelValue":u[0]||(u[0]=e=>X.value.userName=e)},null,8,["modelValue"])])),_:1})):B("",!0),"add"===re.value?(a(),l(W,{key:1,label:"密码",prop:"password"},{default:t((()=>[i(F,{modelValue:X.value.password,"onUpdate:modelValue":u[1]||(u[1]=e=>X.value.password=e)},null,8,["modelValue"])])),_:1})):B("",!0),i(W,{label:"昵称",prop:"nickName"},{default:t((()=>[i(F,{modelValue:X.value.nickName,"onUpdate:modelValue":u[2]||(u[2]=e=>X.value.nickName=e)},null,8,["modelValue"])])),_:1}),i(W,{label:"手机号",prop:"phone"},{default:t((()=>[i(F,{modelValue:X.value.phone,"onUpdate:modelValue":u[3]||(u[3]=e=>X.value.phone=e)},null,8,["modelValue"])])),_:1}),i(W,{label:"邮箱",prop:"email"},{default:t((()=>[i(F,{modelValue:X.value.email,"onUpdate:modelValue":u[4]||(u[4]=e=>X.value.email=e)},null,8,["modelValue"])])),_:1}),i(W,{label:"用户角色",prop:"authorityId"},{default:t((()=>[i(f,{modelValue:X.value.authorityIds,"onUpdate:modelValue":u[5]||(u[5]=e=>X.value.authorityIds=e),style:{width:"100%"},options:R.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),i(W,{label:"启用",prop:"disabled"},{default:t((()=>[i(w,{modelValue:X.value.enable,"onUpdate:modelValue":u[6]||(u[6]=e=>X.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),i(W,{label:"头像","label-width":"80px"},{default:t((()=>[o("div",{style:{display:"inline-block"},onClick:G},[X.value.headerImg?(a(),r("img",{key:0,alt:"头像",class:"header-img-box",src:X.value.headerImg&&"http"!==X.value.headerImg.slice(0,4)?n.value+X.value.headerImg:X.value.headerImg},null,8,ae)):(a(),r("div",le,"从媒体库选择")),i(H,{ref_key:"chooseImg",ref:$,target:X.value,"target-key":"headerImg"},null,8,["target"])])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}});export{te as default};
