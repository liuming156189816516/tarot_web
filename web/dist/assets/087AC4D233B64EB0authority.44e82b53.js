/*! 
 Build based on gin-vue-admin 
 Time : 1718987800000 */
import{a,o as e,c as t,d as l,b as o,w as r,g as i,G as u,b2 as d,h as s,e as n,ap as m,k as p,E as y,J as h,l as v}from"./087AC4D233B64EB0index.72fd2312.js";/* empty css                               *//* empty css                                */import{E as c,a as B}from"./087AC4D233B64EB0tab-pane.ab334272.js";import{E as f}from"./087AC4D233B64EB0dialog.d2da24e2.js";/* empty css                                  *//* empty css                              */import{E as C}from"./087AC4D233B64EB0radio.95911a51.js";/* empty css                               *//* empty css                            */import"./087AC4D233B64EB0checkbox.ca4c4f80.js";/* empty css                                  */import{E,a as A}from"./087AC4D233B64EB0table-column.a0d188fb.js";/* empty css                                *//* empty css                               */import{g as I,d as b,c as D,u as j,a as g}from"./087AC4D233B64EB0authority.4a92693a.js";import w from"./087AC4D233B64EB0menus.f4ef09f9.js";import _ from"./087AC4D233B64EB0apis.eef907cc.js";import k from"./087AC4D233B64EB0datas.fd7274d1.js";import{_ as N}from"./087AC4D233B64EB0warningBar.90f1d9d1.js";import{t as V}from"./087AC4D233B64EB0doc.46160848.js";import{a as x,E as U}from"./087AC4D233B64EB0index.7b396154.js";import{E as S}from"./087AC4D233B64EB0index.1c56beac.js";import"./087AC4D233B64EB0strings.ee229cfb.js";import"./087AC4D233B64EB0use-dialog.3fba8604.js";import"./087AC4D233B64EB0isUndefined.d281c39a.js";import"./087AC4D233B64EB0index.ffab591b.js";import"./087AC4D233B64EB0isEqual.add17071.js";import"./087AC4D233B64EB0_Uint8Array.d3e78e14.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";import"./087AC4D233B64EB0cloneDeep.182936bd.js";import"./087AC4D233B64EB0_baseClone.503fbc91.js";import"./087AC4D233B64EB0_initCloneObject.253b0cea.js";import"./087AC4D233B64EB0index.a0571a5c.js";import"./087AC4D233B64EB0index.ea000fb0.js";import"./087AC4D233B64EB0debounce.1e721c0b.js";import"./087AC4D233B64EB0hasIn.391c448e.js";import"./087AC4D233B64EB0_baseIteratee.e71013e5.js";import"./087AC4D233B64EB0tree.14d56280.js";import"./087AC4D233B64EB0index.dd70ec89.js";import"./087AC4D233B64EB0authorityBtn.c2ec2ae5.js";import"./087AC4D233B64EB0api.9e955f26.js";import"./087AC4D233B64EB0castArray.673ea73c.js";const T={class:"authority"},q={class:"gva-table-box"},R={class:"gva-btn-list"},z={class:"dialog-footer"},O=Object.assign({name:"Authority"},{__name:"authority",setup(O){const F=a([{authorityId:0,authorityName:"根角色"}]),G=a(!1),P=a("add"),W=a({}),$=a("新增角色"),H=a(!1),J=a(!1),M=a({}),X=a({authorityId:0,authorityName:"",parentId:0}),Y=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),Z=a(1),K=a(0),L=a(999),Q=a([]),aa=a({}),ea=async()=>{const a=await I({page:Z.value,pageSize:L.value,...aa.value});0===a.code&&(Q.value=a.data.list,K.value=a.data.total,Z.value=a.data.page,L.value=a.data.pageSize)};ea();const ta=(a,e)=>{W.value[a]=e},la=a(null),oa=a(null),ra=a(null),ia=(a,e)=>{const t=[la,oa,ra];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},ua=a(null),da=()=>{ua.value&&ua.value.resetFields(),X.value={authorityId:0,authorityName:"",parentId:0}},sa=()=>{da(),H.value=!1,J.value=!1},na=()=>{ua.value.validate((async a=>{if(a){switch(X.value.authorityId=Number(X.value.authorityId),P.value){case"add":0===(await g(X.value)).code&&(p({type:"success",message:"添加成功!"}),ea(),sa());break;case"edit":0===(await j(X.value)).code&&(p({type:"success",message:"添加成功!"}),ea(),sa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=X.value.authorityId,a.authority.authorityName=X.value.authorityName,a.authority.parentId=X.value.parentId,a.authority.dataAuthorityId=M.value.dataAuthorityId,a.oldAuthorityId=M.value.authorityId;0===(await D(a)).code&&(p({type:"success",message:"复制成功！"}),ea())}}da(),H.value=!1}}))},ma=()=>{F.value=[{authorityId:0,authorityName:"根角色"}],pa(Q.value,F.value,!1)},pa=(a,e,t)=>{a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===X.value.authorityId,children:[]};pa(a.children,l.children,t||a.authorityId===X.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===X.value.authorityId};e.push(l)}}))},ya=a=>{da(),$.value="新增角色",P.value="add",X.value.parentId=a,ma(),H.value=!0};return(a,I)=>{const D=y,j=h,g=E,O=A,J=C,K=x,L=v,aa=U,da=f,pa=c,ha=B,va=S;return e(),t("div",T,[l(N,{title:"注：右上角头像下拉可切换角色"}),o("div",q,[o("div",R,[l(D,{type:"primary",icon:"plus",onClick:I[0]||(I[0]=a=>ya(0))},{default:r((()=>[i("新增角色")])),_:1}),l(j,{class:"cursor-pointer",onClick:I[1]||(I[1]=a=>u(V)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=8&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:r((()=>[l(u(d))])),_:1})]),l(O,{data:Q.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(g,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(g,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(g,{align:"left",label:"操作",width:"460"},{default:r((a=>[l(D,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,G.value=!0,void(W.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(D,{icon:"plus",type:"primary",link:"",onClick:e=>ya(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(D,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{ma(),$.value="拷贝角色",P.value="copy";for(const e in X.value)X.value[e]=a[e];M.value=a,H.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(D,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{ma(),$.value="编辑角色",P.value="edit";for(const e in X.value)X.value[e]=a[e];ma(),H.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(D,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void m.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await b({authorityId:t.authorityId})).code&&(p({type:"success",message:"删除成功!"}),1===Q.value.length&&Z.value>1&&Z.value--,ea())})).catch((()=>{p({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(da,{modelValue:H.value,"onUpdate:modelValue":I[5]||(I[5]=a=>H.value=a),title:$.value},{footer:r((()=>[o("div",z,[l(D,{onClick:sa},{default:r((()=>[i("取 消")])),_:1}),l(D,{type:"primary",onClick:na},{default:r((()=>[i("确 定")])),_:1})])])),default:r((()=>[l(aa,{ref_key:"authorityForm",ref:ua,model:X.value,rules:Y.value,"label-width":"80px"},{default:r((()=>[l(K,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(J,{modelValue:X.value.parentId,"onUpdate:modelValue":I[2]||(I[2]=a=>X.value.parentId=a),style:{width:"100%"},disabled:"add"===P.value,options:F.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(K,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(L,{modelValue:X.value.authorityId,"onUpdate:modelValue":I[3]||(I[3]=a=>X.value.authorityId=a),disabled:"edit"===P.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(K,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(L,{modelValue:X.value.authorityName,"onUpdate:modelValue":I[4]||(I[4]=a=>X.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),G.value?(e(),s(va,{key:0,modelValue:G.value,"onUpdate:modelValue":I[6]||(I[6]=a=>G.value=a),"with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(ha,{"before-leave":ia,type:"border-card"},{default:r((()=>[l(pa,{label:"角色菜单"},{default:r((()=>[l(w,{ref_key:"menus",ref:la,row:W.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(pa,{label:"角色api"},{default:r((()=>[l(_,{ref_key:"apis",ref:oa,row:W.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(pa,{label:"资源权限"},{default:r((()=>[l(k,{ref_key:"datas",ref:ra,authority:Q.value,row:W.value,onChangeRow:ta},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):n("",!0)])}}});export{O as default};
